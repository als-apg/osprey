services:
  ariel-web:
    container_name: ariel-web
    labels:
      osprey.project.name: "{{ osprey_labels.project_name }}"
      osprey.project.root: "{{ osprey_labels.project_root }}"
      osprey.deployed.at: "{{ osprey_labels.deployed_at }}"
    build:
      context: ./ariel-web
      dockerfile: Dockerfile
    restart: unless-stopped
    ports:
      - "{{ deployment.bind_address | default('127.0.0.1') }}:{{ services.ariel_web.port_host | default(8085) }}:8085"
    environment:
      # Timezone synchronization with host
      - TZ={{ system.timezone }}
      # Config file location
      - CONFIG_FILE=/app/config.yml
      # Python path for osprey imports
      - PYTHONPATH=/app/src
    volumes:
      # Mount config.yml for ARIEL configuration
      - {{ project_root }}/config.yml:/app/config.yml:ro
      # Mount osprey source for imports
      - {{ project_root }}/src:/app/src:ro
    networks:
      - osprey-network
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8085/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s
    depends_on:
      postgresql:
        condition: service_healthy

networks:
  osprey-network:
    external: true
