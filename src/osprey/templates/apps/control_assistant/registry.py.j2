"""
Component registry for {{ app_display_name }}.

Registers all capabilities and context classes with the Osprey framework.
"""

from osprey.registry import (
    RegistryConfigProvider,
    extend_framework_registry,
    CapabilityRegistration,
    ContextClassRegistration,
    RegistryConfig
)

{% if epics_enabled and epics_setup_function %}
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# EPICS GATEWAY CONFIGURATION
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# Configure EPICS gateway for {{ epics_facility|upper }} facility before any EPICS operations.
# This sets up environment variables that EPICSManager will use.
from osprey.utils.epics_gateway_config import {{ epics_setup_function }}

# Configure EPICS for {{ epics_facility|upper }} facility
{{ epics_setup_function }}()
{% endif %}


class {{ app_class_name }}RegistryProvider(RegistryConfigProvider):
    """Registry provider for {{ app_display_name }}.

    Registers control system integration capabilities:
    - Channel finding (semantic search for control system channels)
    - Channel value retrieval (read current values from channels)
    - Archiver retrieval (query historical time-series data)

    Based on production patterns from ALS Assistant.
    """

    def get_registry_config(self) -> RegistryConfig:
        """Return registry configuration for {{ app_display_name }}."""
        return extend_framework_registry(
            capabilities=[
                CapabilityRegistration(
                    name="channel_finding",
                    module_path="{{ package_name }}.capabilities.channel_finding",
                    class_name="ChannelFindingCapability",
                    description="Find control system channels using semantic search",
                    provides=["CHANNEL_ADDRESSES"],
                    requires=[]
                ),
                CapabilityRegistration(
                    name="channel_value_retrieval",
                    module_path="{{ package_name }}.capabilities.channel_value_retrieval",
                    class_name="ChannelValueRetrievalCapability",
                    description="Retrieve current values from control system channels",
                    provides=["CHANNEL_VALUES"],
                    requires=["CHANNEL_ADDRESSES"]
                ),
                CapabilityRegistration(
                    name="archiver_retrieval",
                    module_path="{{ package_name }}.capabilities.archiver_retrieval",
                    class_name="ArchiverRetrievalCapability",
                    description="Query historical time-series data from the archiver",
                    provides=["ARCHIVER_DATA"],
                    requires=["CHANNEL_ADDRESSES", "TIME_RANGE"]
                ),
            ],
            context_classes=[
                ContextClassRegistration(
                    context_type="CHANNEL_ADDRESSES",
                    module_path="{{ package_name }}.context_classes",
                    class_name="ChannelAddressesContext"
                ),
                ContextClassRegistration(
                    context_type="CHANNEL_VALUES",
                    module_path="{{ package_name }}.context_classes",
                    class_name="ChannelValuesContext"
                ),
                ContextClassRegistration(
                    context_type="ARCHIVER_DATA",
                    module_path="{{ package_name }}.context_classes",
                    class_name="ArchiverDataContext"
                ),
            ]
        )

